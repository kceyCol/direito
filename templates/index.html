<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptMaker - Gerador de Prompts para IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/estilos.css">
</head>
<body>
    <div class="container py-4">
        <!-- Header com informa√ß√µes do usu√°rio -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-center">PromptMaker</h1>
            <div class="d-flex align-items-center gap-3">
                <span class="text-muted">Ol√°, {{ user_name }}!</span>
                <a href="{{ url_for('config') }}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-gear"></i> Configura√ß√£o
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-box-arrow-right"></i> Sair
                </a>
            </div>
        </div>
        
        <!-- Resto do conte√∫do existente -->
        <h1 class="mb-4 text-center">Gerador de Prompts para Resumos Jur√≠dicos</h1>
        
        <!-- Se√ß√£o de Configura√ß√£o do Prompt -->
        <div class="card p-4 shadow-sm">
            <h5 class="mb-3">Selecione o tipo de resumo jur√≠dico:</h5>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-4">
                <div class="col">
                    <div class="card tipo-card selected card-tooltip" data-tipo="fichamento_jurisprudencia" data-descricao="Ideal para organizar e sistematizar decis√µes judiciais, extraindo os pontos principais, fundamentos e precedentes relevantes.">
                        <div class="tooltip-text">Ideal para organizar e sistematizar decis√µes judiciais, extraindo os pontos principais, fundamentos e precedentes relevantes.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üìã</div>
                            <h5 class="card-title">Fichamento de Jurisprud√™ncia</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="analise_critica_decisao">
                        <div class="tooltip-text">An√°lise aprofundada de decis√µes judiciais ou pe√ßas processuais, identificando pontos fortes, fracos e estrat√©gias utilizadas.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">‚öñÔ∏è</div>
                            <h5 class="card-title">An√°lise Cr√≠tica da Decis√£o/Pe√ßa</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="mapeamento_estrategia_argumentativa">
                        <div class="tooltip-text">Identifica e mapeia as estrat√©gias argumentativas utilizadas em pe√ßas processuais ou decis√µes, √∫til para prepara√ß√£o de casos similares.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üó∫Ô∏è</div>
                            <h5 class="card-title">Mapeamento da Estrat√©gia Argumentativa</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="analise_contrato_risco">
                        <div class="tooltip-text">Foca na identifica√ß√£o de riscos contratuais, cl√°usulas problem√°ticas e pontos de aten√ß√£o para negocia√ß√£o ou revis√£o.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">‚ö†Ô∏è</div>
                            <h5 class="card-title">An√°lise de Contrato (Foco em Risco)</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="explicacao_cliente_simplificado">
                        <div class="tooltip-text">Transforma textos jur√≠dicos complexos em explica√ß√µes simples e acess√≠veis para clientes leigos.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üí¨</div>
                            <h5 class="card-title">Explica√ß√£o para Cliente (Simplificado)</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="gerador_clausulas_contratuais">
                        <div class="tooltip-text">Auxilia na cria√ß√£o de cl√°usulas contratuais baseadas em modelos e boas pr√°ticas jur√≠dicas.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üìù</div>
                            <h5 class="card-title">Gerador de Cl√°usulas Contratuais</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="esquematizador_peca_processual">
                        <div class="tooltip-text">Cria um esqueleto estruturado para pe√ßas processuais, organizando argumentos e fundamenta√ß√£o legal.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üèóÔ∏è</div>
                            <h5 class="card-title">Esquematizador de Pe√ßa Processual (Esqueleto)</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="analise_impacto_legislativo">
                        <div class="tooltip-text">Analisa o impacto de novas leis ou altera√ß√µes legislativas na pr√°tica jur√≠dica e nos clientes.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üìä</div>
                            <h5 class="card-title">An√°lise de Impacto Legislativo</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="preparacao_inquiricao_testemunha">
                        <div class="tooltip-text">Prepara roteiros e estrat√©gias para inquiri√ß√£o de testemunhas, baseado em fatos e objetivos do caso.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üéØ</div>
                            <h5 class="card-title">Prepara√ß√£o para Inquiri√ß√£o de Testemunha</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="sintese_entendimento_jurisprudencial">
                        <div class="tooltip-text">Sintetiza o entendimento consolidado dos tribunais sobre determinado tema jur√≠dico.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üìö</div>
                            <h5 class="card-title">S√≠ntese de Entendimento Jurisprudencial</h5>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="btnGerar" class="btn btn-primary w-100 mb-3">Gerar Prompt</button>
            <div class="mt-3">
                <label class="form-label">Prompt Gerado:</label>
                <textarea id="outputPrompt" class="form-control" rows="6" readonly></textarea>
            </div>
            <div class="mt-3 d-flex flex-wrap gap-2" id="botoesAcoes" style="display:none;">
                <button id="btnCopiar" class="btn btn-copiar">Copiar Prompt</button>
                <button class="btn btn-gemini" onclick="abrirIA('gemini')">Abrir Gemini</button>
                <button class="btn btn-chatgpt" onclick="abrirIA('chatgpt')">Abrir ChatGPT</button>
                <button class="btn btn-deepseek" onclick="abrirIA('deepseek')">Abrir DeepSeek</button>
                <button class="btn btn-claude" onclick="abrirIA('claude')">Abrir Claude</button>
                <button class="btn btn-perplexity" onclick="abrirIA('perplexity')">Abrir Perplexity</button>
                <button class="btn btn-manus" onclick="abrirIA('manus')">Abrir Manus</button>
            </div>
        </div>
    </div>
    
    <script>
        const urlsIA = {
            'gemini': 'https://gemini.google.com/',
            'chatgpt': 'https://chat.openai.com/',
            'deepseek': 'https://chat.deepseek.com/',
            'claude': 'https://claude.ai/',
            'perplexity': 'https://www.perplexity.ai/',
            'manus': 'https://www.manus.im/'
        };
        
        let tipoSelecionado = 'fichamento_jurisprudencia';
        let tooltipTimeout;
        
        // Detectar se √© dispositivo touch
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar evento de clique aos cards
            document.querySelectorAll('.tipo-card').forEach(card => {
                // Eventos de clique/touch
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Remover sele√ß√£o anterior
                    document.querySelectorAll('.tipo-card').forEach(c => {
                        c.classList.remove('selected');
                        c.classList.remove('show-tooltip');
                    });
                    // Adicionar sele√ß√£o ao card clicado
                    this.classList.add('selected');
                    // Atualizar tipo selecionado
                    tipoSelecionado = this.getAttribute('data-tipo');
                });
                
                // Eventos para tooltip em dispositivos touch
                if (isTouchDevice) {
                    card.addEventListener('touchstart', function(e) {
                        // Limpar timeout anterior
                        clearTimeout(tooltipTimeout);
                        
                        // Remover tooltips de outros cards
                        document.querySelectorAll('.tipo-card').forEach(c => {
                            if (c !== this) c.classList.remove('show-tooltip');
                        });
                        
                        // Mostrar tooltip do card atual
                        this.classList.add('show-tooltip');
                        
                        // Esconder tooltip ap√≥s 3 segundos
                        tooltipTimeout = setTimeout(() => {
                            this.classList.remove('show-tooltip');
                        }, 3000);
                    });
                }
                
                // Inicializar tooltips a partir do atributo data-descricao
                const descricao = card.getAttribute('data-descricao');
                if (descricao) {
                    const tooltipElement = card.querySelector('.tooltip-text');
                    if (tooltipElement) {
                        tooltipElement.textContent = descricao;
                    }
                }
            });
            
            // Esconder tooltip ao tocar fora (apenas para dispositivos touch)
            if (isTouchDevice) {
                document.addEventListener('touchstart', function(e) {
                    if (!e.target.closest('.tipo-card')) {
                        document.querySelectorAll('.tipo-card').forEach(c => {
                            c.classList.remove('show-tooltip');
                        });
                    }
                });
            }
        });

        // Fun√ß√£o para gerar prompt
        document.getElementById('btnGerar').onclick = async function() {
            // Adicionar feedback visual
            this.disabled = true;
            this.textContent = 'Gerando...';
            
            try {
                const categoria = 'direito';
                const tipo = tipoSelecionado;
                
                const resp = await fetch('/gerar_prompt', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({categoria, tipo, texto: ''})
                });
                const json = await resp.json();
                document.getElementById('outputPrompt').value = json.prompt;
                document.getElementById('botoesAcoes').style.display = 'flex';
            } catch (error) {
                alert('Erro ao gerar prompt. Tente novamente.');
            } finally {
                this.disabled = false;
                this.textContent = 'Gerar Prompt';
            }
        };

        // Fun√ß√£o para copiar prompt
        document.getElementById('btnCopiar').onclick = async function() {
            const textarea = document.getElementById('outputPrompt');
            
            try {
                // Usar a API moderna de clipboard se dispon√≠vel
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(textarea.value);
                    this.textContent = 'Copiado!';
                } else {
                    // Fallback para dispositivos mais antigos
                    textarea.select();
                    textarea.setSelectionRange(0, 99999); // Para mobile
                    
                    const successful = document.execCommand('copy');
                    if (successful) {
                        this.textContent = 'Copiado!';
                    } else {
                        // Se falhar, mostrar o texto selecionado para c√≥pia manual
                        alert('Selecione e copie o texto manualmente (Ctrl+C ou Cmd+C)');
                        return;
                    }
                }
                
                setTimeout(() => {
                    this.textContent = 'Copiar Prompt';
                }, 2000);
            } catch (err) {
                // Em caso de erro, selecionar o texto para c√≥pia manual
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                alert('Selecione e copie o texto manualmente (Ctrl+C ou Cmd+C)');
            }
        };

        // Fun√ß√£o para abrir plataformas de IA
        function abrirIA(plataforma) {
            const url = urlsIA[plataforma];
            if (url) {
                // Adicionar pequeno delay para melhor feedback em mobile
                const button = event.target;
                button.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    button.style.transform = '';
                    window.open(url, '_blank');
                }, 100);
            }
        }
        
        // Prevenir zoom em inputs em iOS
        document.addEventListener('touchstart', function(e) {
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') {
                e.target.style.fontSize = '16px';
            }
        });
        
        // Fun√ß√£o para copiar URL
        async function copiarIP(elemento) {
            const texto = elemento.textContent;
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(texto);
                } else {
                    // Fallback para dispositivos mais antigos
                    const textArea = document.createElement('textarea');
                    textArea.value = texto;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                // Feedback visual
                const originalText = elemento.textContent;
                elemento.textContent = 'Copiado!';
                elemento.style.background = '#d4edda';
                
                setTimeout(() => {
                    elemento.textContent = originalText;
                    elemento.style.background = '#f8f9fa';
                }, 1500);
                
            } catch (err) {
                console.error('Erro ao copiar:', err);
                alert('Erro ao copiar. Selecione e copie manualmente.');
            }
        }
    </script>
</body>
</html>